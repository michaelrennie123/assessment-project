<div class="page-container">
  <div class="action-container">
    <p-button
      label="Generate Records"
      size="small"
      icon="pi pi-plus"
      (click)="toggleDialog('generate')"
      styleClass="small-button"
    ></p-button>
    <p-button
      label="Add Customer"
      size="small"
      icon="pi pi-plus"
      styleClass="small-button"
      severity="contrast"
      (click)="requestModify()"
    ></p-button>
    <p-dialog
      header="Generate Random Records"
      [modal]="true"
      [(visible)]="dialogVisibility['generate']"
      [style]="{ width: '30%' }"
    >
      <div style="display: grid; gap: 10px">
        <form>
          <div class="form-control">
            <span class="p-text-secondary block mb-5"
              >How many new records(random) do you wish to generate?</span
            >
            <input
              pInputText
              id="count"
              autocomplete="off"
              [formControl]="generateCount"
              type="number"
            />
            <p-button
              label="Generate"
              size="small"
              (click)="performGenerate()"
              [loading]="apiState.isUpdating"
            />
          </div>
        </form>
      </div>
    </p-dialog>
    <p-dialog
      header="Update Customer"
      [modal]="true"
      [(visible)]="dialogVisibility['update']"
      [style]="{ width: '30%' }"
    >
      <div style="display: grid; gap: 10px">
        <form [formGroup]="currentCustomer" (ngSubmit)="performUpdate()">
          <div *ngFor="let column of editableColumnNames" class="form-control">
            <span style="text-transform: capitalize">{{
              column.formatted
            }}</span>
            <input
              pInputText
              autocomplete="off"
              [formControlName]="column.raw"
            />
          </div>
          <div style="width: 100%; display: flex; justify-content: flex-end">
            <p-button
              label="Update"
              size="small"
              severity="success"
              type="submit"
              [disabled]="!currentCustomer.valid"
              [loading]="apiState.isUpdating"
            />
          </div>
        </form>
      </div>
    </p-dialog>
  </div>
  <div>
    <p-progressSpinner
      *ngIf="apiState.isFetching"
      ariaLabel="loading"
      styleClass="spinner-small"
    />
    <p-table [value]="customers" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th *ngFor="let column of columnNames">
            {{ column.formatted }}
          </th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-customer>
        <tr
          [pTooltip]="tooltipContent"
          (click)="handleSelection(customer)"
          [class.active]="_lastSelectedItemId == customer.id"
        >
          <ng-template #tooltipContent>
            <span>Click to select</span>
          </ng-template>
          <td *ngFor="let column of columnNames">
            {{ getColumnValue(customer, column.raw) }}
          </td>
          <td>
            <p-button
              icon="pi pi-pencil action-button-icon"
              styleClass="action-button"
              severity="contrast"
              (click)="requestModify(customer)"
            />
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
